@echo off
REM set PATH=C:\Program Files\Java\jdk1.7.0_79\bin;%PATH%
set WORKING_DIR=J:\Work\Krieger\LabPLC\HackeoUrbano\dev\MapatonAPI
call cd..
echo ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
ECHO Cleaning and compiling project...
ECHO ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
call mvn clean compile

ECHO ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
ECHO Generating endpoints client libraries...
ECHO ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
call mvn appengine:endpoints_get_client_lib

ECHO ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
ECHO Updating pom in generated client libraries...
ECHO ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
call javac -d . src/main/java/mx/krieger/labplc/mapaton/utils/APIClientsUpdateHelper.java
call java -cp . mx.krieger.labplc.mapaton.utils.APIClientsUpdateHelper > %WORKING_DIR%/result.txt
FINDSTR /C:"--SUCCESS--" /G:%WORKING_DIR%/result.txt  && ( goto update) || (goto error )
:update
ECHO ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
ECHO Deploying clients...
ECHO ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
call cd target/endpoints-client-libs/mapatonAPI 
call mvn deploy
call cd ../../..
call rmdir mx /S /Q
goto done
:error
ECHO ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
ECHO Could not deploy clients...
ECHO ==============================================================================
ECHO ==============================================================================
ECHO ==============================================================================
goto done
:done